<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KidsFantasy</title>
    <link rel="icon" type="image/png" href="logo.png">
    <link rel="stylesheet" type="text/css" href="/styles.css">
</head>
<style>
    #mail {
        border: 2px solid #6e0a0a; 
        border-width: 1px;
        padding: 8px;
        font-size: 16px;
        outline: none; 
    }
    #mail:focus {
            border-color: #6e0a0a; 
            background-color: #bd6c6c; 
    }
    select {
        background-color: #bd6c6c !important; 
        color: black; 
        border: 1px solid #6e0a0a; 
        padding: 10px; 
        font-size: 16px; 
        -webkit-appearance: none; 
        -moz-appearance: none; 
        appearance: none; 
    }    
    
    select:hover {
        background-color: #bd6c6c;
        border-color: #6e0a0a; 
        cursor: pointer;
    }
            
    select:focus {
        background-color: #bd6c6c;
        border-color: #6e0a0a; 
        cursor: pointer;
        outline: none;
    }
</style>
<body>
    <!-- Logo on the side -->
    <img src="/logo.png" alt="KidsFantasy Logo" class="logo" onclick="showForm()">

    <!-- Description Text Box -->
    <div class="description-box" id="description-box">
        <p>
            At KidsFantasy, we bring children’s dreams to life with unforgettable events tailored just for them. With branches in Sharjah, Dubai, and Abu Dhabi, we specialize in creating magical experiences that spark imagination and joy. Whether it’s birthdays, themed celebrations, or unique one-of-a-kind parties, our dedicated team is committed to ensuring every event is filled with fun, excitement, and lasting memories.
        </p>
        <p>
            Our events range from superhero-themed adventures and princess tea parties to intergalactic space journeys and pirate treasure hunts. We offer a variety of customizable options, including venue selection, catering styles, and dynamic themes that cater to children of all ages. Our top priority is to provide a safe, creative, and thrilling atmosphere where kids can express themselves and celebrate their special moments.
        </p>
        <p>
            With years of experience in the event industry, KidsFantasy is your trusted partner for turning any child's fantasies into reality.
        </p>
        <p id="hyperlink-text">
            <a href="#" style="color: #6a0707;" onclick="showForm()">Click here to book an event</a>
        </p>
    </div>

    <!-- Event Registration Form -->
    <form id="event-form" action="/register" method="post" style="display: none;">
        <h1 style="text-align: center;">KidsFantasy Event Registration</h1>

        <!-- Input field for user to enter their Mail ID -->
        <label for="mail">Email Address</label>
        <input type="text" id="mail" name="mail" required>
        
        <!-- Input field for Event Date -->
        <label for="event-date">Date of the Event</label>
        <input type="date" id="event-date" name="event-date" required>

        <!-- Input field for Event Time for a 3 hours duration period -->
        <label for="event-time">Time of the Event:</label>
        <select id="event-time" name="event-time" required>
            <option value="08:00-11:00">08:00 AM - 11:00 AM</option>
            <option value="09:00-12:00">09:00 AM - 12:00 PM</option>
            <option value="10:00-13:00">10:00 AM - 01:00 PM</option>
            <option value="11:00-14:00">11:00 AM - 02:00 PM</option>
            <option value="12:00-15:00">12:00 PM - 03:00 PM</option>
            <option value="13:00-16:00">01:00 PM - 04:00 PM</option>
            <option value="14:00-17:00">02:00 PM - 05:00 PM</option>
            <option value="15:00-18:00">03:00 PM - 06:00 PM</option>
            <option value="16:00-19:00">04:00 PM - 07:00 PM</option>
            <option value="17:00-20:00">05:00 PM - 08:00 PM</option>
            <option value="18:00-21:00">06:00 PM - 09:00 PM</option>
        </select> 
        
        <!-- Venue Selection Dropdown List -->
        <label for="venue">Venue</label>
        <select id="venue" name="venue" required>
            <option value="Sharjah">Sharjah</option>
            <option value="Dubai">Dubai</option>
            <option value="Abu Dhabi">Abu Dhabi</option>
        </select>

        <!-- Event Type Selection Dropdown List -->
        <label for="event-type">Event Type</label>
        <select id="event-type" name="event-type" required>
            <option value="Birthday">Birthday</option>
            <option value="Celebration">Celebration</option>
            <option value="Others">Others</option>
        </select>

        <!-- If user clicks on others this input field will collect additional details -->
        <div id="event-type-others" style="display: none;">
            <label for="event-type-description">Please Specify</label>
            <input type="text" id="event-type-description" name="event-type-description">
        </div>

        <!-- Party Theme Dropdown List -->
        <label for="theme">Theme of Party</label>
        <select id="theme" name="theme" required>
            <option value="None">None</option>
            <option value="Princess">Princess</option>
            <option value="Superhero">Superhero</option>
            <option value="Space">Space</option>
            <option value="Dinosaur">Dinosaur</option>
            <option value="Pirate">Pirate</option>
        </select>

        <!-- Type of Catering Dropdown List -->
        <label for="catering">Select Catering</label>
        <select id="catering" name="catering" required onchange="toggleFoodOptions()">
            <option value="Self-Cater">Self-Cater</option>
            <option value="Buffet">Buffet</option>
        </select>

        <!-- Food Options Dropdown List -->
        <label id="food-options-label" for="food-style" style="display: none;">Select Food Style</label>
        <select id="food-style" name="food-style" style="display: none;">
            <option value="Intercontinental">Intercontinental</option>
            <option value="Italian">Italian</option>
            <option value="Mexican">Mexican</option>
            <option value="Chinese">Chinese</option>
        </select>

        <!-- For the entered date and venue weather is forecasted and displayed -->
         <!-- Dropdown List -->
        <label for="weather-check">Do you want to check the weather report for the event?</label>
        <select id="weather-check" name="weather-check" required>
            <option value="No">No</option>
            <option value="Yes">Yes</option>
        </select>

        <div id="weather-section" style="display: none;">
            <h2>Weather Information</h2>
            <p id="weather-info">Weather information will be displayed here.</p>
        </div>

        <!-- Additional Demands input field -->
        <label for="additional-demands">Additional Demands</label>
        <textarea id="additional-demands" name="additional-demands" rows="4"></textarea>

        <!-- Submit button to end registration -->
        <button type="submit">Register</button>
    </form>

    <!-- All user inputted data displayed -->
    <div id="event-data" style="display: none;">
        <h1>Successful Form Submission</h1>
        <h2>Please lookout for our mail regarding your booking confirmation</h2>
        <p id="event-info"></p>
    </div>
    </body>
    <script>

        document.addEventListener('DOMContentLoaded', function() {
        const emailInput = document.getElementById('mail');
        
            // Pattern to recognize valid email address for validation
            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            
            emailInput.addEventListener('input', function() {
                const email = emailInput.value;
                
                // Checks if the email matches the pattern
                if (!emailPattern.test(email)) {
                    emailInput.style.borderColor = 'red';
                } else {
                    emailInput.style.borderColor = '#6e0a0a';
                }
            });
        });

        // from main page when user clicks on logo or hyperlink in the description box this function is activated through onclick 
        function showForm() {
            // hide logo and description box to only show the event registration form
            document.querySelector('.logo').style.display = 'none';
            document.getElementById('description-box').style.display = 'none';
            document.getElementById('event-form').style.display = 'block';
        }

        //When user clicks on Buffet in catering then all the buffet options are displayed with a check box
        // When user clicks on Buffet in catering then all the buffet options are displayed with a checkbox
        function toggleFoodOptions() {
            const catering = document.getElementById('catering').value;
            const foodOptions = document.getElementById('food-style');
            const foodOptionsLabel = document.getElementById('food-options-label');

            if (catering === 'Buffet') {
                foodOptions.style.display = 'block';
                foodOptionsLabel.style.display = 'block';
            } else {
                foodOptions.style.display = 'none';
                foodOptionsLabel.style.display = 'none';
            }
        }


        //Once user clicks on others in event-type they are ushered to specify by an input description box
        document.getElementById('event-type').addEventListener('change', function() {
            const eventType = this.value;
            const eventTypeOthers = document.getElementById('event-type-others');
            eventTypeOthers.style.display = eventType === 'Others' ? 'block' : 'none';
        });

        // if user clicks on yes to fetch weather data then weatherSection block is displayed
        document.getElementById('weather-check').addEventListener('change', function() {
            const weatherSection = document.getElementById('weather-section');
            if (this.value === 'Yes') {
                fetchWeather();
                weatherSection.style.display = 'block';
            } else {
                weatherSection.style.display = 'none';
            }
        });

        function fetchWeather() {
            const venue = document.getElementById('venue').value;
            const eventDate = document.getElementById('event-date').value;
            const apiKey = '2a683f596b274193884b98b1197a7f3c';
            const url = `https://api.weatherbit.io/v2.0/forecast/daily?city=${venue}&key=${apiKey}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Log the entire API response for debugging
                    const weatherInfo = document.getElementById('weather-info');
                    if (data && data.data) {
                        // Check the actual structure of data.data
                        console.log(data.data); // Log the daily forecast array

                        const forecast = data.data.find(day => day.datetime === eventDate);
                        if (forecast) {
                            weatherInfo.innerHTML = `
                                <strong>Location:</strong> ${forecast.city_name || venue}<br>
                                <strong>Date:</strong> ${forecast.datetime}<br>
                                <strong>Temperature:</strong> ${forecast.temp}°C<br>
                                <strong>Weather:</strong> ${forecast.weather.description}<br>
                                <strong>Humidity:</strong> ${forecast.rh}%<br>
                                <strong>Wind Speed:</strong> ${forecast.wind_spd} km/h<br>
                            `;
                        } else {
                            weatherInfo.innerHTML = 'Weather data not available for the selected date.';
                        }
                    } else {
                        weatherInfo.innerHTML = 'Weather data not available.';
                    }
                })
                .catch(error => {
                    console.error('Error fetching weather data:', error);
                    document.getElementById('weather-info').innerHTML = 'Error fetching weather data.';
                });
        }

        // once user clicks on register/submit button we will display the event-form div through the EventListener
        // to show all the user-inputted data and hide the form
        document.getElementById('event-form').addEventListener('submit', function(event) {
            event.preventDefault();
            document.getElementById('event-form').style.display = 'none';
            const formData = new FormData(this);
            // creating a new object for each form submitted
            const formObject = {};
            formData.forEach((value, key) => {
                if (key === 'food-style') {
                    if (!formObject[key]) formObject[key] = [];
                    formObject[key].push(value);
                } else {
                    formObject[key] = value;
                }
            });

            fetch('/register', {
            method: 'POST',  // Specifies that the request is a POST request
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded'  // Specifies the content type for the form data
            },
            body: new URLSearchParams(formObject).toString()  // Converts the form data to a URL-encoded string
        })
        .then(response => response.json())  // Parses the response as JSON
        .then(data => {
            const eventDataDiv = document.getElementById('event-data');  // Selects the div where event data will be displayed
            const eventInfo = document.getElementById('event-info');  // Selects the element where the event information will be inserted
            eventInfo.innerHTML = `
                <strong>Mail ID:</strong> ${data.mail}<br>
                <strong>Event Date:</strong> ${data.eventDate}<br>
                <strong>Venue:</strong> ${data.venue}<br>
                <strong>Event Type:</strong> ${data.eventType} 
                ${data.eventTypeDescription}
                <br><strong>Theme:</strong> ${data.theme}<br>
                <strong>Catering:</strong> ${data.catering} <br>
                <strong>Food Style:</strong> ${data.foodStyle}<br>
                <strong>Weather Checked:</strong> ${data.weatherChecked ? 'Yes' : 'No'}<br>
                <strong>Additional Demands:</strong> ${data.additionalDemands}<br>
                `;  // Inserts the event data into the HTML 
            eventDataDiv.style.display = 'block';  // Makes the event data div visible
            document.getElementById('event-form').reset();  // Resets the form fields
        })
        .catch(error => console.error('Error:', error));  // Logs any errors to the console
    });
    </script>

</body>
</html>
